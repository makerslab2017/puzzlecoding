<!DOCTYPE html>
<!--페이지로딩후 html 노출-->
<html lang="ko" class="no-js">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="css/common.css">
  <link rel="stylesheet" href="icon/css/font-awesome.min.css">
  <link rel="stylesheet" href="css/style.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="css/jquery.bxslider.css" rel="stylesheet"/>
  <link rel="stylesheet" href="js/Swiper-3.3.1/dist/css/swiper.min.css">
  <!--<link rel="stylesheet" href="css/iziToast.min.css">-->
  <script src="js/Swiper-3.3.1/dist/js/swiper.min.js"></script>
  <script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
  <script src="js/aws-cognito-sdk.min.js"></script>
  <script src="js/amazon-cognito-identity.min.js"></script>
  <script src="js/aws-sdk.min.js"></script>
  <script src="js/aws-cognito-config.js"></script>
  <script src="js/custom.js"></script>
  <script type="text/javascript" src="https://www.google.com/jsapi"></script>
  <script src="js/jquery.bxslider/jquery.bxslider.min.js"></script>
  <!--<script src="js/iziToast.min.js"></script>-->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <!--[if lt IE 9]> <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script> <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script> <![endif]-->
</head>
<body>
  <!--페이지 시작-->
  <div id="page-wrapper">
  	<div id="subpage-top" class="sky">
	 	<div id="subpage-top-wrap">
		 	<div class="index-area">
		 		<span><a href="puzzle-intro.html">퍼즐메이커</a></span>
		 		<span>
	              <i class="fa fa-angle-right" aria-hidden="true"></i>
	            </span>
		 		<span><a href="gallery.html">퍼즐 갤러리</a></span>
		 	</div>
		 	<div class="title-area">
		 		<img src="img/gear.png" alt="톱니바퀴 이미지">
		 		<h1>퍼즐 갤러리</h1>
		 	</div>
		 	<div class="inst-area">
	            <!--드랍다운-->
	            <div class="dropdown">
	              <span class="select-label">공유횟수</span>
	              <input type="hidden" name="cd-dropdown">
	              <ul class="dropdown-list">
	                <li>작성자별</li>
	                <li>공유횟수</li>
	                <li>좋아요횟수</li>
	              </ul>
	            </div>
	            <!--드랍다운끝-->
	            <div class="gallery-search">
	              <div class="flex-box-inner">
	                <span>
	                  <div class="search_wrap">
	                    <input type="text" placeholder="검색어를 입력하세요">
	                    <div class="search_button"><i class="material-icons">search</i></div>
	                    
	                  </div>
	                </span>
	              </div>
	            </div>
	          </div>
		 	
	 	</div>
	 	<div class="bg-area">
	 	</div>
	 </div>
	 
    <!-- <div class="bg-blue">
      <div class="container">
        <div class="row mg0">
          <section class="col-md-4 banner-text">
            <p><a href="puzzle-intro.html">퍼즐메이커</a>
              <span>
                <i class="fa fa-angle-right" aria-hidden="true"></i>
              </span>
              <a href="gallery.html">퍼즐 갤러리</a></p>
              <div class="title-area">
              	<img src="img/gear.png" alt="톱니바퀴 이미지">
	            <h2>
	             	퍼즐갤러리
	            </h2>
            </div>
          </section>
          <div class="col-md-8" style="text-align: right;">
            드랍다운
            <div class="dropdown">
              <span class="select-label">공유횟수</span>
              <input type="hidden" name="cd-dropdown">
              <ul class="dropdown-list">
                <li>작성자별</li>
                <li>공유횟수</li>
                <li>좋아요횟수</li>
              </ul>
            </div>
            드랍다운끝
            <div class="gallery-search">
              <div class="flex-box-inner">
                <span>
                  <div class="search_wrap">
                    <input type="text" placeholder="검색어를 입력하세요">
                    <div class="search_button"><i class="material-icons">search</i></div>
                    
                  </div>
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <img src="img/cloud01.png" class="main-cloud-01" style="top:370px;">
    <img src="img/cloud02.png" class="main-cloud-02" style="top:360px;"> -->
  </div>
  <div class="container">
    <!--갤러리 로우-->
    <div class="row row-margin gallery">
      <div class="col-md-3 col-sm-6" id="next-button">
        <section class="gallery-box" style="visibility:hidden;">
          <div class="gallery-image">
            <img src="img/gallery_dummy.png" alt="더미이미지">
          </div>
          <div class="gallery-list-info">
            <span class="gallery-user-pic"><img src="img/gallery_dummy2.png" alt="더미이미지"></span>
            <span><div class="gallery-title"></div></span>
            <span><div class="gallery-user-name"></div></span>
          </div>
          <div class="gallery-social-info">
            <div><i class="material-icons">&nbsp;</i></div>
          </div>
          
        </section>
        <div class="next-button">
          <div><i class="material-icons">navigate_next</i></div>
        </div>
      </div>
    </div>
    <script>
      var pagination_info = null;
      buildItem = function(item) {
        if ($('#' + item.id).length) return;
        $('<div>', {
          class: "col-md-3 col-sm-6",
          html: '<section id="' + item.id + '" class="gallery-box"><div class="gallery-image" data="puzzleDeco0101"><img src="https://codingpuzzle.org/puzzles/thumbnails/' + item.id + '" alt="더미이미지"></div><div class="gallery-list-info">' //<span class="gallery-user-pic"><img src="img/gallery_dummy2.png" alt="더미이미지"></span>
            + '<span><div class="gallery-title">' + item.title + '</div><div class="gallery-user-name">창작: &nbsp;<span>'+ item.owner + '</span></div></span></div><div class="gallery-social-info"><div><img src="img/coding-challenge-clear.png" alt="퍼즐풀기"><span>' + item.n_solved + '</span></div><div class="like-puzzle"><img src="img/like.png" alt="좋아요"><span class="n-likes">' + item.n_like + '</span></div><div class="dislike-puzzle"><img src="img/dislike.png" alt="싫어요"><span class="n-dislikes">' + item.n_dislike + '</span></div><div><span><i class="material-icons delete-puzzle">delete</i></span></div></div></section>'
        }).appendTo('.gallery');
        $('div:has(> > .delete-puzzle)').css({'cursor': 'pointer'});
      };
      
      $(document).on('click', '.gallery-box', function(e) {
        var id = $(e.currentTarget).attr('id');
        if (id == null) return;
        window.location.href = 'puzzle-view.html?puzzle=' + id;
      });
      $(document).on('click', '.gallery-box .like-puzzle', function(e) {        
        var id = $(e.currentTarget).parents('.gallery-box').attr('id');
        e.stopPropagation();
        if (id == null) return;
        if (puzzleAPI.cognitoUser.username == null) {
          return;
        }
        if ($('.gallery-user-name span', $('#' + id)).html() !== puzzleAPI.cognitoUser.username) {
          puzzleAPI.recordPuzzleLog( id, function() {
            $('#' + id + " .n-likes").text( parseInt($('#' + id + " .n-likes").text()) + 1 );
          }, "liked" );
        }        
      });
      $(document).on('click', '.gallery-box .dislike-puzzle', function(e) {        
        var id = $(e.currentTarget).parents('.gallery-box').attr('id');
        e.stopPropagation();
        if (id == null) return;
        if (puzzleAPI.cognitoUser.username == null) {
          return;
        }
        if ($('.gallery-user-name span', $('#' + id)).html() !== puzzleAPI.cognitoUser.username) {
          puzzleAPI.recordPuzzleLog( id, function() {
            $('#' + id + " .n-dislikes").text( parseInt($('#' + id + " .n-dislikes").text()) + 1 );
          }, "disliked" );
        }        
      });
      $(document).on('click', '.gallery-box .delete-puzzle', function(e) {        
        var id = $(e.currentTarget).parents('.gallery-box').attr('id');
        e.stopPropagation();
        if (id == null) return;
        if (puzzleAPI.cognitoUser == null || puzzleAPI.cognitoUser.username == null) {
          return;
        }
        if ($('.gallery-user-name span', $('#' + id)).html() !== puzzleAPI.cognitoUser.username) {
          swal('퍼즐 제작자만이 삭제할 수 있습니다.', {button: false});
          return;
        }
        swal('삭제하시겠습니까?').then( function(value) {
          if (value === true) puzzleAPI.deletePuzzle(id);
        });
      });
      readFromWeb = function(n_trials) {
        if (n_trials == 0) return;
        $.getJSON( puzzleAPI.apiUrl + 'puzzles',  pagination_info, function(data) {
          console.log(data);
          if (data.hasOwnProperty('items')) {
            $.each(data.items, function(key, value) {
              buildItem({id: value.puzzle_id, title: value.title, owner: value.owner_id, description: value.description, n_solved: value.n_solved + "", n_shared: value.n_shared + "", n_like: value.n_like + "", n_dislike: value.n_dislike + "" } );          
            });
            pagination_info = {
              last_puzzle_id: data.last_puzzle_id,
              last_elapsed_days: data.last_elapsed_days,
              last_created_at: data.last_created_at,
            };
            if ($('.gallery-box').length <= 10)
              readFromWeb(n_trials);
            else readFromWeb(n_trials - 1);
            /*
            if (data.items.length == 0 && pagination_info.last_puzzle_id == null && pagination_info.last_elapsed_days ) {
              readFromWeb(n_trials - 1);
            }
            */
          }
          $('#next-button').appendTo('.gallery');
        });
      };
      readFromWeb(7);
      $('#next-button').on('click', function() { readFromWeb(7);} );
    </script>
  </div>
  <!--푸터시작-->
  <footer>
  </footer>
</body>