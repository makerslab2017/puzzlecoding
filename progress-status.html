<!DOCTYPE html>
<!--페이지로딩후 html 노출-->
<html lang="ko" class="no-js">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="css/common.css">
  <link rel="stylesheet" href="icon/css/font-awesome.min.css">
  <link rel="stylesheet" href="css/style.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="css/jquery.bxslider.css" rel="stylesheet"/>
  <link rel="stylesheet" href="js/Swiper-3.3.1/dist/css/swiper.min.css">
  <script src="js/Swiper-3.3.1/dist/js/swiper.min.js"></script>
  <script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
  <script src="js/aws-cognito-sdk.min.js"></script>
  <script src="js/amazon-cognito-identity.min.js"></script>
  <script src="js/aws-sdk.min.js"></script>
  <script src="js/aws-cognito-config.js"></script>
  <script src="js/custom.js"></script>
  <script type="text/javascript" src="https://www.google.com/jsapi"></script>
  <script src="js/jquery.bxslider/jquery.bxslider.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.0/Chart.min.js"></script>
  <!--[if lt IE 9]> <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script> <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script> <![endif]-->
</head>
<body>
  <!--페이지 시작-->
  <div id="page-wrapper">
  	 <div id="subpage-top" class="green">
	 	<div id="subpage-top-wrap">
		 	<div class="index-area">
		 		<span><a href="progress-status.html">코딩퍼즐 학습</a></span>
		 		<span>
	              <i class="fa fa-angle-right" aria-hidden="true"></i>
	            </span>
		 		<span><a href="progress-status.html">학습진도 현황</a></span>
		 	</div>
		 	<div class="title-area">
		 		<img src="img/intro-image.png" alt="리스트 이미지">
		 		<h1>교육과정소개</h1>
		 	</div>
		 	<div class="inst-area">
		 		<span>
		 		지금까지 학습한 내용과 달성도를 확인할 수 있어요.
		 		</span>
		 	</div>
	 	</div>
	 	<div class="bg-area">
	 	</div>
	 </div>
	 
    <!-- <div class="bg-saph">
      <div class="container">
        <section class="banner-text col-md-10" style="max-width:100%">
          <p>
            <a href="progress-status.html">
            코딩퍼즐 학습</a>
            <span>
              <i class="fa fa-angle-right" aria-hidden="true"></i>
            </span>
            <a href="progress-status.html">
            학습진도 현황</a>
          </p>
        </section>
      </div>
      <div class="container">
        <div class="row mg0">
          <div class="col-md-12">
          	<div class="title-area">
	            <img src="img/intro-image.png" alt="리스트 이미지">
	            <h2 class="status-page-title">학습진도 현황</h2>
            </div>
            <p class="lh2">지금까지 학습한 내용과 달성도를 확인할 수 있어요.</p>
          </div>
        </div>
      </div>
      <img src="img/about-coding-cloud01.png" alt="좌측구름" class="about-cloud-01">
      <img src="img/about-coding-cloud02.png" alt="우측구름" class="about-cloud-02">

    </div> -->
    <div class="container status-container">
      <div class="row">
        <div class="col-md-12">
          <div class="status-box">
            <div class="flex-box flex-box-on-status">
              <ul class="class-list">
                <li class="class-name" course="elementary">
                  초급과정
                </li>
                <li class="class-name" course="middle">
                  중급과정
                </li>
              </ul>
              <div class="flex-box-inner">
                <div class="search-span">
                  <div class="search_wrap">
                    <input type="text" placeholder="학생이름으로 검색">
                    <div class="search_button">
                      <i class="material-icons">search</i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="status-graph-wrapper flex-box" style="justify-content: center;">
        <canvas id="chart">
        </canvas>
        
        <!--
        <div class="row" style="width:1180px;margin:0;">
          <div class="col-xs-11 col-xs-offset-1">
            <div class="status-chasi-wrapper">
              <div class="status-chasi">
                1차시
              </div>
              <div class="status-chasi">
                2차시
              </div>
              <div class="status-chasi">
                3차시
              </div>
              <div class="status-chasi">
                4차시
              </div>
              <div class="status-chasi">
                5차시
              </div>
              <div class="status-chasi">
                6차시
              </div>
              <div class="status-chasi">
                7차시
              </div>
              <div class="status-chasi">
                8차시
              </div>
              <div class="status-chasi">
                9차시
              </div>
              <div class="status-chasi">
                10차시
              </div>
              <div class="status-chasi">
                11차시
              </div>
              <div class="status-chasi">
                12차시
              </div>
            </div>
          </div>
        </div>

        <div class="row" style="width:1180px">
          <div class="col-xs-1">
            <p class="status-student-name">홍길동</p>
          </div>
          <div class="col-xs-11">
            <div class="ex-graph"></div>
          </div>
        </div>
        -->
      </div>
    </div>
  </div>
  <script>
    var COLORS = [
		  '#4dc9f6',
		  '#f67019',
		  '#f53794',
		  '#537bc4',
		  '#acc236',
		  '#166a8f',
		  '#00a950',
		  '#58595b',
		  '#8549ba'
	  ];
    var ctx = null;
    const users_progress = {
      users: null,
      elementary: null,
      middle: null
    };
    puzzleAPI.currentUser();
    $(document).ready(function() {
      $.ajax( { type: 'GET', url: puzzleAPI.apiUrl + 'courses',
        headers: { 'Authorization' : puzzleAPI.token },
        success: (data) => {
          console.log(data);
          users_progress.users = data.enrolled_students;
        },
        fail: (err) => {
          users_progress.users = null;
          users_progress.elementary = {};
          users_progress.middle = {};
        }
      });
      ctx = $('canvas')[0].getContext('2d');
    });
    var course_data = null;
    var stat = {};
    var chart_element = null;
    
    
    var show_progress = () => {
      if (chart_element)
        chart_element.destroy();
      var labels = [];
      for (var lesson in course_data.lessons) 
        labels.push(lesson.replace('lesson-', ''));
      datasets = [];
      for (var user in stat) {
        color = '#'+(Math.random()*0xFFFFFF<<0).toString(16);
        datasets.push( {
          label: user,
          backgroundColor: color,
          borderColor: color,
          data: stat[user],
          fill: false
        });
      }
      chart_element = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: datasets
        },
        options: {
          responsive: true,
          title: {
            display: true,
            text: '교육과정별 학생 진도 평가 현황'
          },
          tooltips: {
            mode: 'point',
            intersect: false
          },
          hover: {
            mode: 'nearest',
            intersect: true,
          },
          scales: {
            xAxes: [ {
              display: true,
              scaleLabel: {
                display: true,
                labelString: '차시'
              }
            }],
            yAxes: [{
              ticks: {
                beginAtZero: true
              },
              display: true,
              scaleLabel: {
                display: true,
                labelString: '스테이지 완수률'
              }
            }]
          }
        }
      });
    };

    $(document).on('click', '.status-box .chasi-active', function() {
      var course_id = $(this).attr('course');
      if (users_progress.users == null) return;
      users_progress[course_id] = null;
      $.getJSON( 'courses/' + course_id, function(data) {
        course_data = data;
        $.ajax( { type: 'GET', url: puzzleAPI.apiUrl + 'courses/' + course_id,
          headers: { 'Authorization' : puzzleAPI.token },
          success: (data) => {
            console.log(data);
            users_progress[course_id] = {};
            stat = {};
            for (var i=0; i< users_progress.users.length; i++) {
              var user = users_progress.users[i];
              if (data.course_progresses.hasOwnProperty(user)) {
                var progress = data.course_progresses[user];
                console.log(progress);
                stat[user] = [];
                for (var lesson in course_data.lessons) {
                  var n_completed = 0;
                  for (var j=0; j < course_data.lessons[lesson].stages.length; j++) {
                    var stage = course_data.lessons[lesson].stages[j];
                    if (progress.hasOwnProperty(stage) && progress[stage] == "completed")
                      n_completed++;
                  }
                  stat[user].push(n_completed * 100 / course_data.lessons[lesson].stages.length );
                }
              }
            }
            console.log(stat);
            show_progress();
          },
          fail: (err) => {
            users_progress[course_id] = null;
          }
        }); 
      });
    });
  </script>

  <!--푸터시작-->
  <footer>
  </footer>
  <!--푸터 끝-->
</body>